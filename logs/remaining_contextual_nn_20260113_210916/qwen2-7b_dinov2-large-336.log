======================================================================
CONTEXTUAL NN (WITH IMAGE PRELOADING)
======================================================================
Checkpoint: molmo_data/checkpoints/train_mlp-only_pixmo_cap_resize_qwen2-7b_dinov2-large-336/step12000-unsharded
Contextual dir: molmo_data/contextual_llm_embeddings_vg/Qwen_Qwen2-7B
Visual layers: [0, 1, 16, 2, 24, 26, 27, 4, 8]
Contextual layers: [1, 2, 4, 8, 16, 24, 26, 27]
Images: 36 (indices: [100, 102, 108, 109, 119]...)
Total forward passes: 8 caches × 36 images = 288

======================================================================
LOADING MODEL
======================================================================
  Loading weights...
  Moving to GPU (fp16)...
✓ Model loaded in 1289.9s

======================================================================
PRELOADING IMAGES TO GPU
======================================================================
  Loading 36 images directly to GPU...
    0/36 (image 100)...
    10/36 (image 155)...
    20/36 (image 234)...
    30/36 (image 284)...
✓ Images preloaded in 14.9s (2.4 img/s)

======================================================================
CONTEXTUAL LAYER 1 (1/8)
======================================================================
  Loading cache to GPU... done (203.7s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (72315.6 img/s)
    Image 6/36 (idx=134) (1.5 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.2 img/s)
    Image 36/36 (idx=299) (1.2 img/s)
  ✓ Done: 36 images in 29.9s (1.2 img/s)
======================================================================
CONTEXTUAL LAYER 2 (2/8)
======================================================================
  Loading cache to GPU... done (170.9s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (80659.7 img/s)
    Image 6/36 (idx=134) (1.7 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.3 img/s)
    Image 36/36 (idx=299) (1.3 img/s)
  ✓ Done: 36 images in 29.6s (1.2 img/s)
======================================================================
CONTEXTUAL LAYER 4 (3/8)
======================================================================
  Loading cache to GPU... done (93.7s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (102300.1 img/s)
    Image 6/36 (idx=134) (1.7 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.3 img/s)
    Image 36/36 (idx=299) (1.2 img/s)
  ✓ Done: 36 images in 29.7s (1.2 img/s)
======================================================================
CONTEXTUAL LAYER 8 (4/8)
======================================================================
  Loading cache to GPU... done (67.0s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (89240.5 img/s)
    Image 6/36 (idx=134) (1.7 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.2 img/s)
    Image 36/36 (idx=299) (1.2 img/s)
  ✓ Done: 36 images in 30.0s (1.2 img/s)
======================================================================
CONTEXTUAL LAYER 16 (5/8)
======================================================================
  Loading cache to GPU... done (90.7s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (82241.3 img/s)
    Image 6/36 (idx=134) (1.7 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.3 img/s)
    Image 36/36 (idx=299) (1.2 img/s)
  ✓ Done: 36 images in 29.8s (1.2 img/s)
======================================================================
CONTEXTUAL LAYER 24 (6/8)
======================================================================
  Loading cache to GPU... done (28.3s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (107546.3 img/s)
    Image 6/36 (idx=134) (1.7 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.3 img/s)
    Image 36/36 (idx=299) (1.2 img/s)
  ✓ Done: 36 images in 29.9s (1.2 img/s)
======================================================================
CONTEXTUAL LAYER 26 (7/8)
======================================================================
  Loading cache to GPU... done (28.8s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (99864.4 img/s)
    Image 6/36 (idx=134) (1.7 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.2 img/s)
    Image 36/36 (idx=299) (1.2 img/s)
  ✓ Done: 36 images in 30.0s (1.2 img/s)
======================================================================
CONTEXTUAL LAYER 27 (8/8)
======================================================================
  Loading cache to GPU... done (29.7s, 300836 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (59918.6 img/s)
    Image 6/36 (idx=134) (1.7 img/s)
    Image 11/36 (idx=155) (1.4 img/s)
    Image 16/36 (idx=191) (1.3 img/s)
    Image 21/36 (idx=234) (1.3 img/s)
    Image 26/36 (idx=257) (1.3 img/s)
    Image 31/36 (idx=284) (1.2 img/s)
    Image 36/36 (idx=299) (1.2 img/s)
  ✓ Done: 36 images in 30.1s (1.2 img/s)

✓ All caches processed in 957.5s (16.0 min)

======================================================================
BUILDING RESULTS
======================================================================
  Image 1/36 (idx=100)...
  Image 21/36 (idx=234)...
✓ Results built in 80.9s

======================================================================
SAVING RESULTS
======================================================================
  ✓ contextual_neighbors_visual0_allLayers.json
  ✓ contextual_neighbors_visual1_allLayers.json
  ✓ contextual_neighbors_visual16_allLayers.json
  ✓ contextual_neighbors_visual2_allLayers.json
  ✓ contextual_neighbors_visual24_allLayers.json
  ✓ contextual_neighbors_visual26_allLayers.json
  ✓ contextual_neighbors_visual27_allLayers.json
  ✓ contextual_neighbors_visual4_allLayers.json
  ✓ contextual_neighbors_visual8_allLayers.json

======================================================================
✓ DONE!
  Preload: 14.9s | Search: 957.5s | Build: 80.9s
  Total: 1053.3s (17.6 min)
  Output: analysis_results/contextual_nearest_neighbors_supplement/train_mlp-only_pixmo_cap_resize_qwen2-7b_dinov2-large-336_step12000-unsharded/train_mlp-only_pixmo_cap_resize_qwen2-7b_dinov2-large-336_step12000-unsharded
======================================================================
