======================================================================
CONTEXTUAL NN (WITH IMAGE PRELOADING)
======================================================================
Checkpoint: molmo_data/checkpoints/train_mlp-only_pixmo_cap_resize_olmo-7b_dinov2-large-336/step12000-unsharded
Contextual dir: molmo_data/contextual_llm_embeddings_vg/allenai_OLMo-7B-1024-preview
Visual layers: [0]
Contextual layers: [1, 2, 4, 8, 16, 24, 30, 31]
Images: 36 (indices: [100, 102, 108, 109, 119]...)
Total forward passes: 8 caches × 36 images = 288

======================================================================
LOADING MODEL
======================================================================
  Loading weights...
  Moving to GPU (fp16)...
✓ Model loaded in 1432.7s

======================================================================
PRELOADING IMAGES TO GPU
======================================================================
  Loading 36 images directly to GPU...
    0/36 (image 100)...
    10/36 (image 155)...
    20/36 (image 234)...
    30/36 (image 284)...
✓ Images preloaded in 1.7s (20.6 img/s)

======================================================================
CONTEXTUAL LAYER 1 (1/8)
======================================================================
  Loading cache to GPU... done (193.0s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (76260.1 img/s)
    Image 6/36 (idx=134) (8.6 img/s)
    Image 11/36 (idx=155) (9.1 img/s)
    Image 16/36 (idx=191) (9.3 img/s)
    Image 21/36 (idx=234) (9.4 img/s)
    Image 26/36 (idx=257) (9.5 img/s)
    Image 31/36 (idx=284) (9.5 img/s)
    Image 36/36 (idx=299) (9.8 img/s)
  ✓ Done: 36 images in 3.9s (9.3 img/s)
======================================================================
CONTEXTUAL LAYER 2 (2/8)
======================================================================
  Loading cache to GPU... done (191.4s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (80659.7 img/s)
    Image 6/36 (idx=134) (14.1 img/s)
    Image 11/36 (idx=155) (11.7 img/s)
    Image 16/36 (idx=191) (11.1 img/s)
    Image 21/36 (idx=234) (10.7 img/s)
    Image 26/36 (idx=257) (10.5 img/s)
    Image 31/36 (idx=284) (10.4 img/s)
    Image 36/36 (idx=299) (10.3 img/s)
  ✓ Done: 36 images in 3.6s (10.0 img/s)
======================================================================
CONTEXTUAL LAYER 4 (3/8)
======================================================================
  Loading cache to GPU... done (73.2s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (74898.3 img/s)
    Image 6/36 (idx=134) (14.0 img/s)
    Image 11/36 (idx=155) (11.7 img/s)
    Image 16/36 (idx=191) (11.0 img/s)
    Image 21/36 (idx=234) (10.7 img/s)
    Image 26/36 (idx=257) (10.5 img/s)
    Image 31/36 (idx=284) (10.4 img/s)
    Image 36/36 (idx=299) (10.3 img/s)
  ✓ Done: 36 images in 3.6s (10.0 img/s)
======================================================================
CONTEXTUAL LAYER 8 (4/8)
======================================================================
  Loading cache to GPU... done (78.8s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (80659.7 img/s)
    Image 6/36 (idx=134) (14.0 img/s)
    Image 11/36 (idx=155) (11.7 img/s)
    Image 16/36 (idx=191) (11.0 img/s)
    Image 21/36 (idx=234) (10.6 img/s)
    Image 26/36 (idx=257) (10.4 img/s)
    Image 31/36 (idx=284) (10.3 img/s)
    Image 36/36 (idx=299) (10.2 img/s)
  ✓ Done: 36 images in 3.6s (9.9 img/s)
======================================================================
CONTEXTUAL LAYER 16 (5/8)
======================================================================
  Loading cache to GPU... done (152.3s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (37117.7 img/s)
    Image 6/36 (idx=134) (13.9 img/s)
    Image 11/36 (idx=155) (11.7 img/s)
    Image 16/36 (idx=191) (11.0 img/s)
    Image 21/36 (idx=234) (10.6 img/s)
    Image 26/36 (idx=257) (10.5 img/s)
    Image 31/36 (idx=284) (10.3 img/s)
    Image 36/36 (idx=299) (10.2 img/s)
  ✓ Done: 36 images in 3.6s (10.0 img/s)
======================================================================
CONTEXTUAL LAYER 24 (6/8)
======================================================================
  Loading cache to GPU... done (131.8s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (85598.0 img/s)
    Image 6/36 (idx=134) (13.8 img/s)
    Image 11/36 (idx=155) (11.6 img/s)
    Image 16/36 (idx=191) (10.9 img/s)
    Image 21/36 (idx=234) (10.6 img/s)
    Image 26/36 (idx=257) (10.4 img/s)
    Image 31/36 (idx=284) (10.3 img/s)
    Image 36/36 (idx=299) (10.2 img/s)
  ✓ Done: 36 images in 3.6s (10.0 img/s)
======================================================================
CONTEXTUAL LAYER 30 (7/8)
======================================================================
  Loading cache to GPU... done (53.2s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (89240.5 img/s)
    Image 6/36 (idx=134) (14.0 img/s)
    Image 11/36 (idx=155) (11.4 img/s)
    Image 16/36 (idx=191) (10.8 img/s)
    Image 21/36 (idx=234) (10.5 img/s)
    Image 26/36 (idx=257) (10.3 img/s)
    Image 31/36 (idx=284) (10.2 img/s)
    Image 36/36 (idx=299) (10.1 img/s)
  ✓ Done: 36 images in 3.7s (9.9 img/s)
======================================================================
CONTEXTUAL LAYER 31 (8/8)
======================================================================
  Loading cache to GPU... done (73.7s, 306962 embeddings on GPU)
  Processing 36 images (from GPU)...
    Image 1/36 (idx=100) (73584.3 img/s)
    Image 6/36 (idx=134) (13.9 img/s)
    Image 11/36 (idx=155) (11.6 img/s)
    Image 16/36 (idx=191) (11.0 img/s)
    Image 21/36 (idx=234) (10.6 img/s)
    Image 26/36 (idx=257) (10.4 img/s)
    Image 31/36 (idx=284) (10.3 img/s)
    Image 36/36 (idx=299) (10.2 img/s)
  ✓ Done: 36 images in 3.6s (9.9 img/s)

✓ All caches processed in 978.1s (16.3 min)

======================================================================
BUILDING RESULTS
======================================================================
  Image 1/36 (idx=100)...
Traceback (most recent call last):
  File "/home/nlp/users/bkroje/vl_embedding_spaces/third_party/molmo/scripts/analysis/contextual_nearest_neighbors_allLayers_singleGPU.py", line 455, in <module>
    main()
  File "/home/nlp/users/bkroje/vl_embedding_spaces/third_party/molmo/scripts/analysis/contextual_nearest_neighbors_allLayers_singleGPU.py", line 407, in main
    "ground_truth_caption": cached_images[img_idx]['caption'],
IndexError: list index out of range
