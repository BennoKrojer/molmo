======================================================================
CONTEXTUAL NN (WITH IMAGE PRELOADING)
======================================================================
Checkpoint: molmo_data/checkpoints/ablations/train_mlp-only_pixmo_topbottom_olmo-7b_vit-l-14-336_unfreeze-llm/step12000-unsharded
Contextual dir: molmo_data/contextual_llm_embeddings_vg/train_mlp-only_pixmo_topbottom_olmo-7b_vit-l-14-336_unfreeze-llm
Visual layers: [0, 1, 2, 4, 8, 16, 24, 30, 31]
Contextual layers: [1, 2, 4, 8, 16, 24, 30, 31]
Images: 100
Total forward passes: 8 caches × 100 images = 800

======================================================================
LOADING MODEL
======================================================================
  Loading weights...
  Moving to GPU (bf16)...
✓ Model loaded in 72.8s

======================================================================
PRELOADING IMAGES TO GPU
======================================================================
  Loading 100 images directly to GPU...
    0/100...
    10/100...
    20/100...
    30/100...
    40/100...
    50/100...
    60/100...
    70/100...
    80/100...
    90/100...
✓ Images preloaded in 5.2s (19.3 img/s)

======================================================================
CONTEXTUAL LAYER 1 (1/8)
======================================================================
  Loading cache to GPU... done (15.2s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (95325.1 img/s)
    Image 6/100 (1.3 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.1 img/s)
    Image 36/100 (1.1 img/s)
    Image 41/100 (1.1 img/s)
    Image 46/100 (1.1 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 98.8s (1.0 img/s)
======================================================================
CONTEXTUAL LAYER 2 (2/8)
======================================================================
  Loading cache to GPU... done (4.0s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (93206.8 img/s)
    Image 6/100 (1.4 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.0 img/s)
    Image 36/100 (1.0 img/s)
    Image 41/100 (1.0 img/s)
    Image 46/100 (1.0 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 101.4s (1.0 img/s)
======================================================================
CONTEXTUAL LAYER 4 (3/8)
======================================================================
  Loading cache to GPU... done (16.8s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (87381.3 img/s)
    Image 6/100 (1.4 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.1 img/s)
    Image 36/100 (1.0 img/s)
    Image 41/100 (1.0 img/s)
    Image 46/100 (1.0 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 101.2s (1.0 img/s)
======================================================================
CONTEXTUAL LAYER 8 (4/8)
======================================================================
  Loading cache to GPU... done (3.9s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (93206.8 img/s)
    Image 6/100 (1.4 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.0 img/s)
    Image 36/100 (1.0 img/s)
    Image 41/100 (1.0 img/s)
    Image 46/100 (1.0 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 102.0s (1.0 img/s)
======================================================================
CONTEXTUAL LAYER 16 (5/8)
======================================================================
  Loading cache to GPU... done (6.0s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (95325.1 img/s)
    Image 6/100 (1.4 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.0 img/s)
    Image 36/100 (1.0 img/s)
    Image 41/100 (1.0 img/s)
    Image 46/100 (1.0 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 101.9s (1.0 img/s)
======================================================================
CONTEXTUAL LAYER 24 (6/8)
======================================================================
  Loading cache to GPU... done (5.5s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (95325.1 img/s)
    Image 6/100 (1.4 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.0 img/s)
    Image 36/100 (1.0 img/s)
    Image 41/100 (1.0 img/s)
    Image 46/100 (1.0 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 101.7s (1.0 img/s)
======================================================================
CONTEXTUAL LAYER 30 (7/8)
======================================================================
  Loading cache to GPU... done (18.8s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (79137.8 img/s)
    Image 6/100 (1.4 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.1 img/s)
    Image 36/100 (1.0 img/s)
    Image 41/100 (1.0 img/s)
    Image 46/100 (1.0 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 101.3s (1.0 img/s)
======================================================================
CONTEXTUAL LAYER 31 (8/8)
======================================================================
  Loading cache to GPU... done (10.8s, 306962 embeddings on GPU)
  Processing 100 images (from GPU)...
    Image 1/100 (107546.3 img/s)
    Image 6/100 (1.4 img/s)
    Image 11/100 (1.2 img/s)
    Image 16/100 (1.1 img/s)
    Image 21/100 (1.1 img/s)
    Image 26/100 (1.1 img/s)
    Image 31/100 (1.0 img/s)
    Image 36/100 (1.0 img/s)
    Image 41/100 (1.0 img/s)
    Image 46/100 (1.0 img/s)
    Image 51/100 (1.0 img/s)
    Image 56/100 (1.0 img/s)
    Image 61/100 (1.0 img/s)
    Image 66/100 (1.0 img/s)
    Image 71/100 (1.0 img/s)
    Image 76/100 (1.0 img/s)
    Image 81/100 (1.0 img/s)
    Image 86/100 (1.0 img/s)
    Image 91/100 (1.0 img/s)
    Image 96/100 (1.0 img/s)
    Image 100/100 (1.0 img/s)
  ✓ Done: 100 images in 101.6s (1.0 img/s)

✓ All caches processed in 897.6s (15.0 min)

======================================================================
BUILDING RESULTS
======================================================================
  Image 1/100...
  Image 21/100...
  Image 41/100...
  Image 61/100...
  Image 81/100...
✓ Results built in 130.1s

======================================================================
SAVING RESULTS
======================================================================
  ✓ contextual_neighbors_visual0_allLayers.json
  ✓ contextual_neighbors_visual1_allLayers.json
  ✓ contextual_neighbors_visual2_allLayers.json
  ✓ contextual_neighbors_visual4_allLayers.json
  ✓ contextual_neighbors_visual8_allLayers.json
  ✓ contextual_neighbors_visual16_allLayers.json
  ✓ contextual_neighbors_visual24_allLayers.json
  ✓ contextual_neighbors_visual30_allLayers.json
  ✓ contextual_neighbors_visual31_allLayers.json

======================================================================
✓ DONE!
  Preload: 5.2s | Search: 897.6s | Build: 130.1s
  Total: 1032.9s (17.2 min)
  Output: analysis_results/contextual_nearest_neighbors/ablations/train_mlp-only_pixmo_topbottom_olmo-7b_vit-l-14-336_unfreeze-llm_step12000-unsharded/train_mlp-only_pixmo_topbottom_olmo-7b_vit-l-14-336_unfreeze-llm_step12000-unsharded
======================================================================
